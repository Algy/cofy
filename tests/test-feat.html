<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Feat.js - JavaScript Persistent Data Structure Test</title>
  <style>
    html, body { margin: 0; padding: 0; }
    body { font: 12px Arial, sans-serif; background: #FFF; color: #000; padding: 20px; }
    h1 { margin: 0; padding: 0 0 20px; font: bold 24px/1 Arial, sans-serif; text-align: left; }
    .download { padding: 0 0 20px; font-weight: bold; }
    .download a { color: #036; }
    #result { padding: 3px 10px; }
    #log { padding: 10px; font-family: monospace; }
  </style>
  <script>
    var tests = (function (nil) {
      'use strict';
      return {
        create_empty: function () {
          this.isSame(FEAT.map().count(), 0);
          this.isSame(FEAT.map({}).count(), 0);
        },
        create_from_object: function () {
          var map = FEAT.map({a: 1, b: 2, c: 3});
          this.isSame(map.count(), 3);
          this.isSame(map.get('a'), 1);
          this.isSame(map.get('b'), 2);
          this.isSame(map.get('c'), 3);
        },
        depth_grows: function () {
          var map = FEAT.map();
          this.isSame(map.depth(), 0);
          map = map.assoc('a', 1);
          this.isSame(map.depth(), 1);
          map = map.assoc('b', 2);
          this.isSame(map.depth(), 2);
          map = map.assoc('c', 3).assoc('d', 4);
          this.isTrue(map.depth() >= 3);
        },
        retrieve_item: function () {
          var map = FEAT.map({a: 1, b: 2});
          this.isSame(map.get('a'), 1);
          this.isSame(map.get('b'), 2);
          this.isUndefined(map.get('c'));
          this.isSame(map.get('c', 3), 3);
        },
        contains_item: function () {
          var map = FEAT.map({a: 1, b: 2});
          this.isTrue(map.contains('a'));
          this.isTrue(map.contains('b'));
          this.isFalse(map.contains('c'));
        },
        adding_items: function () {
          var i, a = ['y', 'a', 'c', 'z', 'b', 'x'];
          var map1 = FEAT.map();
          var map2 = map1;
          for (i = 0; i < a.length; i++)
            map2 = map2.assoc(a[i], i + 1);
          this.isSame(map1.count(), 0);
          this.isSame(map2.count(), a.length);
          for (i = 0; i < a.length; i++)
            this.isSame(map2.get(a[i]), i + 1);
        },
        removing_items: function () {
          var i, a = ['c', 'z', 'y', 'a', 'x', 'b'];
          var map1 = FEAT.map();
          for (i = 0; i < a.length; i++)
            map1 = map1.assoc(a[i], i + 1);
          var map2 = map1;
          for (i = 0; i < a.length; i++)
            map2 = map2.dissoc(a[i]);
          this.isSame(map1.count(), a.length);
          this.isSame(map2.count(), 0);
          for (i = 0; i < a.length; i++)
            this.isUndefined(map2.get(a[i]));
        },
        ballances_low_depth: function () {
          var i;
          var map = FEAT.map();
          for (i = 0; i < 301; i++)
            map = map.assoc('a' + i, i + 1);
          this.isTrue(map.depth() < 15);
          map = FEAT.map();
          for (i = 0; i < 301; i++)
            map = map.assoc('a' + (300 - i), i + 1);
          this.isTrue(map.depth() < 15);
          map = FEAT.map();
          for (i = 0; i < 301; i++)
            map = map.assoc('a' + (Math.random() * 1000 | 0), i + 1);
          this.isTrue(map.depth() < 15);
        },
        convert_to_object: function () {
          var key, o1 = { a: 1, b: 2, c: 3 }, o2 = FEAT.map(o1).toObject();
          this.isNotSame(o1, o2);
          for (key in o1)
            this.isSame(o1[key], o2[key]);
          for (key in o2)
            this.isSame(o2[key], o1[key]);
        },
        convert_to_string: function () {
          var map = FEAT.map({ c: 3, a: 1, b: 2 });
          this.isSame(map.toString(), '{ a: 1, b: 2, c: 3 }');
          this.isSame(FEAT.map().toString(), '{ }');
        },
        getting_keys_sorted_default: function () {
          var map = FEAT.map({ c: 1, a: 2, b: 3 });
          this.isSame(map.keys().toString(), 'a,b,c');
        },
        getting_keys_sorted_with_comparator: function () {
          var map = FEAT.map({ c: 1, a: 2, b: 3 }, function (a, b) { return a > b; });
          this.isSame(map.keys().toString(), 'c,b,a');
        },
        getting_values_default: function () {
          var map = FEAT.map({ c: 1, a: 2, b: 3 });
          this.isSame(map.values().toString(), '2,3,1');
        },
        getting_values_with_comparator: function () {
          var map = FEAT.map({ c: 1, a: 2, b: 3 }, function (a, b) { return a > b; });
          this.isSame(map.values().toString(), '1,3,2');
        }
      };
    }());
  </script>
</head>
<body onload="run()">
  <h1>Feat.js - JavaScript Persistent Data Structures</h1>
  <div class="download"><a href="../lang/feat.js">Download feat.js</a></div>
  <div id="result"></div>
  <div id="log"></div>
  <script src="../tools/test.js"></script>
  <script src="../lang/feat.js"></script>
  <script>
    function run() {
      'use strict';
      var result = document.getElementById('result');
      var log = document.getElementById('log');
      TEST.init(result, log)(tests);
    }
  </script>
</body>
</html>

