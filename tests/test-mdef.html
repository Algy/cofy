<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JavaScript Minimalistic Test Framework Test</title>
<style>
html, body { margin: 0; padding: 0; }
body { font: 14px Arial, sans-serif; background: #FFF; color: #000; padding: 20px; }
#result { padding: 3px 10px; }
#log { padding: 10px; font-family: monospace; }
#log b { color: #900; background: #FEE; }
</style>
<script>

var TESTS = (function () {
    return {

        use_fn_is_called_if_no_submodules: function () {
            var called = false;
            MDEF.reset();

            MDEF.use([], function () {
                called = true;
            });

            this.is.true(called);
        },

        mod_fn_is_not_called_if_no_submodules: function () {
            var called = false;
            MDEF.reset();

            MDEF.mod('x', [], function () {
                called = true;
            });

            this.is.false(called);
        },

        mod_fn_is_called_if_used_after: function () {
            var called = '';
            MDEF.reset();

            MDEF.mod('y', [], function () {
                called += '(mod y [])';
                return 'Y';
            });

            MDEF.mod('x', ['y'], function (y) {
                called += '(mod x [y])' + y;
                return 'X';
            });

            MDEF.use(['x'], function (x) {
                called += '(use [x])' + x;
            });

            this.is.same(called, '(mod y [])(mod x [y])Y(use [x])X');
        },

        mod_fns_are_called_if_used_before: function () {
            var called = '';
            MDEF.reset();

            MDEF.use(['x'], function (x) {
                called += '(use [x])' + x;
            });

            MDEF.mod('x', ['y'], function (y) {
                called += '(mod x [y])' + y;
                return 'X';
            });

            MDEF.mod('y', [], function () {
                called += '(mod y [])';
                return 'Y';
            });

            this.is.same(called, '(mod y [])(mod x [y])Y(use [x])X');
        },

        tree_submodules_are_defined_bottom_up: function () {
            var called = '';
            MDEF.reset();

            MDEF.use(['a'], function (a) {
                called += ' ' + a;
            });

            MDEF.mod('a', ['b', 'c'], function (b, c) {
                called += 'A';
                return 'a[' + b + c + ']';
            });

            MDEF.mod('b', ['d', 'e'], function (d, e) {
                called += 'B';
                return 'b[' + d + e + ']';
            });

            MDEF.mod('c', ['e'], function (e) {
                called += 'C';
                return 'c[' + e + ']';
            });

            MDEF.mod('d', ['c'], function (c) {
                called += 'D';
                return 'd[' + c + ']';
            });

            this.is.same(called, '');

            MDEF.mod('e', [], function () {
                called += 'E';
                return 'e';
            });

            this.is.same(called, 'ECDBA a[b[d[c[e]]e]c[e]]');

            MDEF.use(['b', 'd'], function (b, d) {
                called += ' ' + b + d;
            });

            this.is.same(called, 'ECDBA a[b[d[c[e]]e]c[e]] b[d[c[e]]e]d[c[e]]');
        }
    };
}());

var RUN = function () {
    TEST.init(document.getElementById('result'), document.getElementById('log'))(TESTS);
};
</script>
</head>

<body onload="RUN()">
<div id="result"></div>
<div id="log"></div>
<script src="../tools/test.js"></script>
<script src="../tools/mdef.js"></script>
</body>
</html>

