<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cofy Lisp Interpreter in JavaScript Test</title>
  <style>
    html, body { margin: 0; padding: 0; }
    body { font: 12px Arial, sans-serif; background: #FFF; color: #000; padding: 20px; }
    #result { padding: 3px 10px; }
    #log { padding: 10px; font-family: monospace; }
  </style>
  <script>
    var tests = (function () {
      return {
        read: {
          constants: function () {
            this.isSame(COFY.read('0').head, 0);
            this.isSame(COFY.read('"hello"').head, 'hello');
            this.isSame(COFY.read('"he\\\\\\"llo"').head, 'he\\"llo');
            this.isSame(COFY.read('hello').head.name, 'hello');
          },
          lists: function () {
            this.isSame(COFY.read('()').head, null);
            this.isSame(COFY.read("'()").head.head.name, 'quote');
            this.isSame(COFY.read("'()").head.tail.head, null);
            this.isSame(COFY.read("'()").head.tail.tail, null);
            this.isSame(COFY.read('(1)').head.head, 1);
            this.isSame(COFY.read('(1)').head.tail, null);
            this.isSame(COFY.read('((1) 2)').head.head.head, 1);
            this.isSame(COFY.read('((1) 2)').head.tail.head, 2);
            this.isSame(COFY.read('((1) 2)').head.tail.tail, null);
          },
          multiple: function () {
            this.isSame(COFY.read('0 1').head, 0);
            this.isSame(COFY.read('0 1').tail.head, 1);
            this.isSame(COFY.read('0 1').tail.tail, null);
          }
        },
        eval: {
          constants: function () {
            this.isSame(COFY.read_eval('0'), 0);
            this.isSame(COFY.read_eval('"hello"'), 'hello');
            this.isSame(COFY.read_eval("'hello").name, 'hello');
            this.isSame(COFY.read_eval('()'), null);
            this.isSame(COFY.read_eval("'()"), null);
            this.isSame(COFY.read_eval("'(1)").head, 1);
            this.isSame(COFY.read_eval("'(1)").tail, null);
            this.isSame(COFY.read_eval("'((1))").head.head, 1);
            this.isSame(COFY.read_eval('0 1'), 1);
            this.isSame(COFY.read_eval('true'), true);
            this.isSame(COFY.read_eval('false'), false);
            this.isSame(COFY.read_eval('nil'), undefined);
          },
          identity: function () {
            this.isTrue(COFY.read_eval('(identical? 0 0)'));
            this.isFalse(COFY.read_eval('(identical? 0 1)'));
            this.isTrue(COFY.read_eval('(identical? "a" "a")'));
            this.isFalse(COFY.read_eval('(identical? "a" "b")'));
            this.isTrue(COFY.read_eval('(identical? "a" \'"a")'));
            this.isTrue(COFY.read_eval("(identical? 'a 'a)"));
            this.isFalse(COFY.read_eval("(identical? 'a 'b)"));
            this.isTrue(COFY.read_eval("(identical? () '())"));
          },
          equality: function () {
            this.isTrue(COFY.read_eval('(= 0 0)'));
            this.isFalse(COFY.read_eval('(= 0 1)'));
            this.isTrue(COFY.read_eval('(= "a" "a")'));
            this.isTrue(COFY.read_eval('(= "a" \'"a")'));
            this.isFalse(COFY.read_eval('(= "a" "b")'));
            this.isTrue(COFY.read_eval("(= 'a 'a)"));
            this.isFalse(COFY.read_eval("(= 'a 'b)"));
            this.isTrue(COFY.read_eval("(= () '())"));
            this.isTrue(COFY.read_eval("(= '(()) '(()))"));
            this.isFalse(COFY.read_eval("(= '(0 a) '(0 b))"));
            this.isTrue(COFY.read_eval("(= '(0 (a)) '(0 (a)))"));
          },
          math: function () {
            this.isSame(COFY.read_eval('(+)'), 0);
            this.isSame(COFY.read_eval('(+ 1 2 3 4)'), 10);
            this.isSame(COFY.read_eval('(- 1 2)'), -1);
            this.isSame(COFY.read_eval('(*)'), 1);
            this.isSame(COFY.read_eval('(* 1 2 3 4)'), 24);
            this.isSame(COFY.read_eval('PI'), Math.PI);
            this.isSame(COFY.read_eval('(abs 1)'), 1);
            this.isSame(COFY.read_eval('(abs -1)'), 1);
            this.isSame(COFY.read_eval('(min 2 1 3)'), 1);
            this.isSame(COFY.read_eval('(max 2 1 3)'), 3);
            this.isSame(COFY.read_eval('random'), Math.random);
            this.isSame(COFY.read_eval('(round 1.6)'), 2);
            this.isSame(COFY.read_eval('(floor 1.6)'), 1);
            this.isSame(COFY.read_eval('(ceil 1.4)'), 2);
            this.isTrue(COFY.read_eval('(< 1 2 3)'));
            this.isFalse(COFY.read_eval('(< 1)'));
            this.isFalse(COFY.read_eval('(< 1 2 2)'));
            this.isFalse(COFY.read_eval('(< 1 2 1)'));
            this.isTrue(COFY.read_eval('(<= 1)'));
            this.isTrue(COFY.read_eval('(<= 1 2 3)'));
            this.isTrue(COFY.read_eval('(<= 1 2 2)'));
            this.isFalse(COFY.read_eval('(<= 1 2 1)'));
          },
          interop: function () {
            this.isSame(COFY.read_eval('(fn (a b) (-(+ a b)))')(1, 2), -3);
            this.isSame(COFY.read_eval('(fn (a) (fn (b) (+ a b)))')(1)(2), 3);
            this.isSame(COFY.read_eval('(fn (f) (f 1 2))')(function (a, b) { return a + b; }), 3);
            this.isSame(COFY.read_eval('(fn (f) (fn (a b) (f a b)))')(function (a, b) { return a + b; })(1, 2), 3);
          }
        }
      };
    }());
  </script>
</head>
<body onload="run()">
  <div id="result"></div>
  <div id="log"></div>
  <script src="../tools/js.js"></script>
  <script src="../tools/test.js"></script>
  <script src="../lang/core.js"></script>
  <script>
    function run() {
      var result = document.getElementById('result');
      var log = document.getElementById('log');
      TEST.init(result, log)(tests);
    }
  </script>
  <script type="application/x-cofy">
    ()
  </script>
</body>
</html>

